<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="BZZ decoding."><title>sndjvu_codec::bzz::dec - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-804b98a1284a310a.css"><meta name="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="sndjvu_codec" data-themes="" data-resource-suffix="" data-rustdoc-version="1.77.0-nightly (2d7be7393 2023-12-23)" data-channel="nightly" data-search-js="search-2b6ce74ff89ae146.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../../static.files/storage-f2adc0d6ca4d09fb.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../../static.files/main-305769736d49e732.js"></script><noscript><link rel="stylesheet" href="../../../static.files/noscript-feafe1bb7466e4bd.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../../sndjvu_codec/index.html">sndjvu_codec</a><span class="version">0.0.0</span></h2></div><h2 class="location"><a href="#">Module dec</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#functions">Functions</a></li></ul></section><h2><a href="../index.html">In sndjvu_codec::bzz</a></h2></div></nav><div class="sidebar-resizer"></div>
    <main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../../sndjvu_codec/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">sndjvu_codec</a>::<wbr><a href="../index.html">bzz</a>::<wbr><a class="mod" href="#">dec</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../../src/sndjvu_codec/bzz/dec.rs.html#1-371">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>bzz</code></strong> only.</div></span><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>BZZ decoding.</p>
<p>This module implements a strongly-typed state machine. The states are:</p>
<ul>
<li><a href="struct.Start.html" title="struct sndjvu_codec::bzz::dec::Start"><code>Start</code></a>: ready to decompress a block of input</li>
<li><a href="struct.Block.html" title="struct sndjvu_codec::bzz::dec::Block"><code>Block</code></a>: we’ve decoded the size of a block and are in the process of decoding its contents</li>
<li><a href="struct.Shuffle.html" title="struct sndjvu_codec::bzz::dec::Shuffle"><code>Shuffle</code></a>: we’ve decoded the stream of “symbols” that represents the current block, and are
ready to (1) “shuffle” those symbols into output bytes and (2) start decompressing the next
block. (These two can proceed in parallel, which is one reason for the decomposed
state-machine design.)</li>
</ul>
<p>The functions <a href="struct.Start.html#method.step" title="method sndjvu_codec::bzz::dec::Start::step"><code>Start::step</code></a> and <a href="struct.Block.html#method.step" title="method sndjvu_codec::bzz::dec::Block::step"><code>Block::step</code></a> implement state transitions that consume some
bytes from the input stream. You can present bytes to the decoder incrementally, and these
functions will return <a href="../../enum.Step.html#variant.Incomplete" title="variant sndjvu_codec::Step::Incomplete"><code>Step::Incomplete</code></a> when more bytes need to be presented; the decoder is
“suspended”, see <a href="struct.StartSave.html" title="struct sndjvu_codec::bzz::dec::StartSave"><code>StartSave</code></a> and <a href="struct.BlockSave.html" title="struct sndjvu_codec::bzz::dec::BlockSave"><code>BlockSave</code></a>.</p>
<h3 id="example-decoding-loop"><a href="#example-decoding-loop">Example decoding loop</a></h3>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">fn </span>decompress(bzz: <span class="kw-2">&amp;</span>[u8], scratch: <span class="kw-2">&amp;mut </span>Scratch) -&gt; <span class="prelude-ty">Result</span>&lt;Vec&lt;u8&gt;, Error&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>out = <span class="macro">vec!</span>[];
    <span class="kw">let </span><span class="kw-2">mut </span>start = start(bzz);
    <span class="kw">loop </span>{
        <span class="kw">let </span><span class="kw-2">mut </span>block = <span class="kw">loop </span>{
            start = <span class="kw">match </span>start.step(scratch) {
                Complete(<span class="prelude-val">None</span>) =&gt; <span class="kw">return </span><span class="prelude-val">Ok</span>(out),
                Complete(<span class="prelude-val">Some</span>(enc)) =&gt; <span class="kw">break </span>enc,
                Incomplete(save) =&gt; save.seal(),
            };
        };
        <span class="kw">let </span>(shuffle, next) = <span class="kw">loop </span>{
            block = <span class="kw">match </span>block.step()<span class="question-mark">? </span>{
                Complete((shuf, enc)) =&gt; <span class="kw">break </span>(shuf, enc),
                Incomplete(save) =&gt; save.seal(),
            };
        };
        <span class="kw">let </span>pos = out.len();
        out.resize(pos + shuffle.len(), <span class="number">0</span>);
        shuffle.run(<span class="kw-2">&amp;mut </span>out[pos..]);
        start = next;
    }
}</code></pre></div>
</div></details><h2 id="structs" class="section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Block.html" title="struct sndjvu_codec::bzz::dec::Block">Block</a></div><div class="desc docblock-short">State of the decoder while decoding the contents of a block.</div></li><li><div class="item-name"><a class="struct" href="struct.BlockSave.html" title="struct sndjvu_codec::bzz::dec::BlockSave">BlockSave</a></div><div class="desc docblock-short">Suspended state of the decoder that will resolve to <a href="struct.Block.html" title="struct sndjvu_codec::bzz::dec::Block"><code>Block</code></a>.</div></li><li><div class="item-name"><a class="struct" href="struct.Error.html" title="struct sndjvu_codec::bzz::dec::Error">Error</a></div><div class="desc docblock-short">An error encountered while decoding a BZZ block.</div></li><li><div class="item-name"><a class="struct" href="struct.Shuffle.html" title="struct sndjvu_codec::bzz::dec::Shuffle">Shuffle</a></div><div class="desc docblock-short">State of the decoder after the initial decoding pass over a block.</div></li><li><div class="item-name"><a class="struct" href="struct.Start.html" title="struct sndjvu_codec::bzz::dec::Start">Start</a></div><div class="desc docblock-short">Initial state of the decoder, ready to start a block.</div></li><li><div class="item-name"><a class="struct" href="struct.StartSave.html" title="struct sndjvu_codec::bzz::dec::StartSave">StartSave</a></div><div class="desc docblock-short">Suspended state of the decoder that will resolve to <a href="struct.Start.html" title="struct sndjvu_codec::bzz::dec::Start"><code>Start</code></a>.</div></li></ul><h2 id="functions" class="section-header"><a href="#functions">Functions</a></h2><ul class="item-table"><li><div class="item-name"><a class="fn" href="fn.start.html" title="fn sndjvu_codec::bzz::dec::start">start</a></div><div class="desc docblock-short">Start decoding some BZZ-compressed bytes.</div></li></ul></section></div></main></body></html>